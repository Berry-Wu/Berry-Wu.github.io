<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>瑞吉外卖优化 | Wzy's Blog</title><meta name="author" content="wzy"><meta name="copyright" content="wzy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="瑞吉外卖的优化部分，涉及redis等">
<meta property="og:type" content="article">
<meta property="og:title" content="瑞吉外卖优化">
<meta property="og:url" content="http://example.com/2023/07/02/ReggieOptim/index.html">
<meta property="og:site_name" content="Wzy&#39;s Blog">
<meta property="og:description" content="瑞吉外卖的优化部分，涉及redis等">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/cheems.jpg">
<meta property="article:published_time" content="2023-07-02T14:38:56.000Z">
<meta property="article:modified_time" content="2023-07-11T06:12:11.635Z">
<meta property="article:author" content="wzy">
<meta property="article:tag" content="springboot">
<meta property="article:tag" content="Nginx">
<meta property="article:tag" content="Cache">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/cheems.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2023/07/02/ReggieOptim/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '瑞吉外卖优化',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-11 14:12:11'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cheems.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/bk2.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Wzy's Blog"><span class="site-name">Wzy's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">瑞吉外卖优化</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-02T14:38:56.000Z" title="发表于 2023-07-02 22:38:56">2023-07-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-11T06:12:11.635Z" title="更新于 2023-07-11 14:12:11">2023-07-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE/">实战项目</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">12.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>48分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="瑞吉外卖优化"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p>视频学习：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV13a411q753?p=156">黑马程序员Java项目实战瑞吉外卖</a></p>
<p>部分内容参考：<a target="_blank" rel="noopener" href="https://cyborg2077.github.io/">Kyle’s Blog</a></p>
</blockquote>
<h1 id="Git管理代码"><a href="#Git管理代码" class="headerlink" title="Git管理代码"></a>Git管理代码</h1><p>这里将瑞吉外卖的不同版本纳入Git管理，方便观察优化历程</p>
<ol>
<li><p>将原本的Reggie导入版本控制。VCS–&gt;Great Git Repository–&gt;选择要上传的项目</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230708102116611.png" alt="image-20230708102116611"></p>
</li>
<li><p>创建好后会出现<code>.gitignore</code>文件，这里从资料中拷贝相应内容覆盖</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">.git</span><br><span class="line">logs</span><br><span class="line">rebel.xml</span><br><span class="line">target/</span><br><span class="line">!.mvn/wrapper/maven-wrapper.jar</span><br><span class="line">log.path_IS_UNDEFINED</span><br><span class="line">.DS_Store</span><br><span class="line">offline_user.md</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## STS ###</span></span></span><br><span class="line">.apt_generated</span><br><span class="line">.classpath</span><br><span class="line">.factorypath</span><br><span class="line">.project</span><br><span class="line">.settings</span><br><span class="line">.springBeans</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## IntelliJ IDEA ###</span></span></span><br><span class="line">.idea</span><br><span class="line">*.iws</span><br><span class="line">*.iml</span><br><span class="line">*.ipr</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## NetBeans ###</span></span></span><br><span class="line">nbproject/private/</span><br><span class="line">build/</span><br><span class="line">nbbuild/</span><br><span class="line">dist/</span><br><span class="line">nbdist/</span><br><span class="line">.nb-gradle/</span><br><span class="line">generatorConfig.xml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment">## nacos ###</span></span></span><br><span class="line">third-party/nacos/derby.log</span><br><span class="line">third-party/nacos/data/</span><br><span class="line">third-party/nacos/work/</span><br><span class="line"></span><br><span class="line">file/</span><br></pre></td></tr></table></figure>
</li>
<li><p>然后<code>右键项目--&gt;Git--&gt;Add</code>，将文件添加到暂存区</p>
</li>
<li><p><code>右键项目--&gt;Git--&gt;Commit</code>，将文件提交到版本库</p>
<ul>
<li><p>此时会指定远程仓库地址，将在github上创建的仓库地址拿来即可</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230708103053400.png" alt="image-20230708103053400"></p>
</li>
<li><p>然后Push到远程仓库</p>
</li>
<li><p>此时就在master分支上创建完成</p>
</li>
</ul>
</li>
<li><p>因为我们想要保存不同的版本，所以这里在此基础上创建新的分支，进行后续的改动</p>
<ul>
<li><p>IDEA右下角点击master，然后创建分支<code>v1.0</code>，此时右下角显示<code>v1.0</code>表明切换到了这个分支</p>
</li>
<li><p>然后将这个分支也推送到远程仓库，此时<code>右键项目--&gt;Git--&gt;Push</code>即可，并且显示新的分支</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230708103650752.png" alt="image-20230708103650752"></p>
</li>
<li><p>然后直接push即可</p>
</li>
</ul>
</li>
</ol>
<p>此时就会有两个分支，目前内容一致</p>
<ul>
<li><p>master</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230708103805596.png" alt="image-20230708103805596"></p>
</li>
<li><p>v1.0</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230708103825995.png" alt="image-20230708103825995"></p>
</li>
</ul>
<hr>
<h1 id="缓存优化"><a href="#缓存优化" class="headerlink" title="缓存优化"></a>缓存优化</h1><p>为什么需要缓存优化？</p>
<ul>
<li>当用户数量过多时，系统访问量大，频繁的访问数据库，系统性能下降，用户体验差。</li>
<li>所以一些通用、常用的数据，可以使用Redis来缓存，避免用户频繁访问数据库</li>
</ul>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><h3 id="导入坐标"><a href="#导入坐标" class="headerlink" title="导入坐标"></a>导入坐标</h3><p>使用SpringDataRedis来开发</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>配置redis的相关设置，在yml配置文件下添加即可。</p>
<blockquote>
<p>这里因为我用的window端的，没有创建密码</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">redis:</span></span><br><span class="line">  <span class="attr">host:</span> <span class="number">172.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">  <span class="attr">database:</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<h3 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h3><p>在<code>config</code>包下新建<code>RedisConfig</code>类</p>
<ul>
<li>配置序列化器，方便在图形化界面中查看存入的数据</li>
<li>但是也可以不配置RedisConfig，而是直接用框架自动创建的<code>SpringRedisConfig</code>，但它的默认序列化器是<code>JdkSerializationRedisSerializer</code>。这种不便于观察</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> <span class="keyword">extends</span> <span class="title class_">CachingConfigurerSupport</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; redisTemplate = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//默认key序列化器为：JdkSerializationRedisSerializer</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后提交到远程仓库，首先进行Add，然后直接点击图标集成commit和push</p>
<h2 id="缓存短信验证码"><a href="#缓存短信验证码" class="headerlink" title="缓存短信验证码"></a>缓存短信验证码</h2><h3 id="实现思路"><a href="#实现思路" class="headerlink" title="实现思路"></a>实现思路</h3><p>前面我们已经实现了移动端手机验证码登录，随机生成的验证码我们是保存在<strong>HttpSession</strong>中的，</p>
<p>现在需要改造为将验证码缓存在Redis中，具体的实现思路如下：</p>
<ol>
<li>在服务端UserController中注入RedisTemplate对象，用于操作Redis;</li>
<li>在服务端UserController的sendMsg方法中，将随机生成的验证码缓存到Redis中，并设置有效期为5分钟;</li>
<li>在服务端UserController的login方法中，从Redis中获取缓存的验证码，如果登录成功则删除Redis中的验证码;</li>
</ol>
<h3 id="代码改造"><a href="#代码改造" class="headerlink" title="代码改造"></a>代码改造</h3><ol>
<li><p>在服务端UserController中注入RedisTemplate对象，用于操作Redis;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在服务端UserController的sendMsg方法中，将随机生成的验证码缓存到Redis中，并设置有效期为5分钟;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span> <span class="keyword">throws</span> MessagingException &#123;</span><br><span class="line">    <span class="comment">//获取手机号/邮箱</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//调用工具类完成验证码发送</span></span><br><span class="line">    <span class="keyword">if</span> (!phone.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">//随机生成一个验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> MailUtils.achieveCode();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//这里的phone其实就是邮箱，code是我们生成的验证码</span></span><br><span class="line">        MailUtils.sendTestMail(phone, code); <span class="comment">//这部分抛出异常</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//[old]将要发送的验证码保存在session，然后与用户填入的验证码进行对比</span></span><br><span class="line">        <span class="comment">//session.setAttribute(phone, code);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//[new]将生成的验证码缓存到Redis中，并设置有效期为5分钟</span></span><br><span class="line">        redisTemplate.opsForValue().set(phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;验证码发送成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;验证码发送失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在服务端UserController的login方法中，从Redis中获取缓存的验证码，如果登录成功则删除Redis中的验证码;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map, HttpSession session)</span> &#123;</span><br><span class="line">    log.info(map.toString());</span><br><span class="line">    <span class="comment">//获取邮箱</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line">    <span class="comment">//获取验证码</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//[old]从session中获取保存的验证码</span></span><br><span class="line">    <span class="comment">//Object codeInSession = session.getAttribute(phone);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//[new]从Redis中获取缓存验证码</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进行验证码的比对</span></span><br><span class="line">    <span class="keyword">if</span> (codeInSession != <span class="literal">null</span> &amp;&amp; codeInSession.equals(code)) &#123;</span><br><span class="line">        <span class="comment">//判断一下当前用户是否存在</span></span><br><span class="line">        LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//从数据库中查询是否有其邮箱</span></span><br><span class="line">        queryWrapper.eq(User::getPhone, phone);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);</span><br><span class="line">        <span class="comment">//如果不存在，则创建一个，存入数据库</span></span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setPhone(phone);</span><br><span class="line">            user.setStatus(<span class="number">1</span>);</span><br><span class="line">            userService.save(user);</span><br><span class="line">            user.setName(<span class="string">&quot;游客&quot;</span> + codeInSession);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//登录成功后，需要保存session，表示登录状态，因为前面的过滤器进行了用户登录判断</span></span><br><span class="line">        session.setAttribute(<span class="string">&quot;user&quot;</span>, user.getId());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//[new]如果用户登录成功，删除redis中缓存的验证码</span></span><br><span class="line">        redisTemplate.delete(phone);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//并将其作为结果返回</span></span><br><span class="line">        <span class="keyword">return</span> R.success(user);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>然后此时再登录手机端，可以看到redis数据库中获取到验证码，登陆后数据库中该条数据就会被清除</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230708114815574.png" alt="image-20230708114815574"></p>
<h2 id="缓存菜品数据"><a href="#缓存菜品数据" class="headerlink" title="缓存菜品数据"></a>缓存菜品数据</h2><p>菜品数据是登录移动端之后的展示页面，所以每当访问首页的时候，都会调用数据库查询一遍菜品数据。对于这种需要频繁访问的数据，可以将其缓存到Redis中以减轻服务器的压力</p>
<h3 id="实现思路-1"><a href="#实现思路-1" class="headerlink" title="实现思路"></a>实现思路</h3><p>移动端对应的菜品查看功能，是DishController中的list方法，此方法会根据前端提交的查询条件进行数据库查询操作（用户选择不同的菜品分类）。在高并发的情况下，频繁查询数据库会导致系统性能下降，服务端响应时间增长。所以现在我们需要对此方法进行缓存优化，提高系统性能。</p>
<p>但是还有存在一个问题：是将所有的菜品缓存一份，还是按照菜品&#x2F;套餐分类，来进行缓存数据呢？</p>
<ul>
<li>答案是后者，当我们点击某一个分类时，只需展示当前分类下的菜品，而其他分类的菜品数据并不需要展示，所以我们在缓存的时候，<strong>根据菜品的分类，缓存多分数据</strong>，页面在查询时，点击某个分类，则查询对应分类下的菜品的缓存数据</li>
</ul>
<p>具体实现思路如下</p>
<ol>
<li>修改DishController中的list方法，先从Redis中获取分类对应的菜品数据，如果有，则直接返回；如果无，则查询数据库，并将查询到的菜品数据存入Redis</li>
<li>修改DishController的save、update和delete方法，加入清理缓存的逻辑，避免产生脏数据（在后台修改&#x2F;更新&#x2F;删除了某些菜品，但由于缓存数据未被清理，未重新查询数据库，导致用户看到的还是修改之前的数据）</li>
</ol>
<h3 id="代码改造-1"><a href="#代码改造-1" class="headerlink" title="代码改造"></a>代码改造</h3><ol>
<li><p>注入RedisTemplate对象，用于操作Redis;</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改DishController的list方法，先从Redis中获取菜品数据，如果有就直接返回缓存数据，没有则查询数据库，并缓存</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;DishDto&gt;&gt; <span class="title function_">get</span><span class="params">(Dish dish)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dish.getCategoryId() + <span class="string">&quot;_&quot;</span> + dish.getStatus();</span><br><span class="line">    List&lt;DishDto&gt; dishDtoList;</span><br><span class="line">    <span class="comment">//先从redis中获取缓存数据</span></span><br><span class="line">    dishDtoList = (List&lt;DishDto&gt;) redisTemplate.opsForValue().get(key);</span><br><span class="line">    <span class="comment">//如果存在，则直接返回，无需查询数据库</span></span><br><span class="line">    <span class="keyword">if</span> (dishDtoList != <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果不存在则执行下述数据库查询操作，查询后将数据缓存在redis</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    lqw.eq(dish.getCategoryId() != <span class="literal">null</span>, Dish::getCategoryId, dish.getCategoryId());</span><br><span class="line">    lqw.eq(Dish::getStatus, <span class="number">1</span>);</span><br><span class="line">    lqw.orderByAsc(Dish::getSort).orderByDesc(Dish::getUpdateTime);</span><br><span class="line">    List&lt;Dish&gt; list = dishService.list(lqw);</span><br><span class="line"></span><br><span class="line">    dishDtoList = list.stream().map((item) -&gt; &#123;</span><br><span class="line">        <span class="type">DishDto</span> <span class="variable">dishDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DishDto</span>();</span><br><span class="line">        BeanUtils.copyProperties(item, dishDto);</span><br><span class="line"></span><br><span class="line">        <span class="type">Long</span> <span class="variable">id</span> <span class="operator">=</span> item.getId();</span><br><span class="line">        LambdaQueryWrapper&lt;DishFlavor&gt; flavorlqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">        flavorlqw.eq(DishFlavor::getDishId, id);</span><br><span class="line">        List&lt;DishFlavor&gt; flavors = dishFlavorService.list(flavorlqw);</span><br><span class="line"></span><br><span class="line">        dishDto.setFlavors(flavors);</span><br><span class="line">        <span class="comment">//将dishDto作为结果返回</span></span><br><span class="line">        <span class="keyword">return</span> dishDto;</span><br><span class="line">        <span class="comment">//将所有返回结果收集起来，封装成List</span></span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将数据缓存在redis中，设置持续时间60min</span></span><br><span class="line">    redisTemplate.opsForValue().set(key, dishDtoList, <span class="number">60</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> R.success(dishDtoList);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里顺便完善了foreach，将其修改为stream流形式遍历，因为之前的方法需要将每个dishDto add到dishDtoList，但由于更改了<code>List&lt;DishDto&gt; dishDtoList</code>的初始位置，并且首次从redis中会进行查询赋值，可能导致dishDtoList为空，调用add方法导致空指针异常的出现。</p>
</blockquote>
</li>
<li><p>此时redis数据库中获取到了数据</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230708125325431.png" alt="image-20230708125325431"></p>
</li>
<li><p>修改DishController里的save、update和批量修改方法(status)，加入清理缓存的逻辑</p>
<ul>
<li><p>save函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;菜品新增数据&#123;&#125;&quot;</span>, dishDto.toString());</span><br><span class="line">    dishService.saveWithFlavor(dishDto);</span><br><span class="line">    <span class="comment">//新增清除原本redis中缓存对应类别的数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDto.getCategoryId() + <span class="string">&quot;_1&quot;</span>;</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;菜品新增成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>update函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDto dishDto)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;菜品修改数据&#123;&#125;&quot;</span>, dishDto.toString());</span><br><span class="line">    dishService.updateWithFlavor(dishDto);</span><br><span class="line">    <span class="comment">//修改商品后清除原本redis中保存的该类别的缓存数据</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dishDto.getCategoryId() + <span class="string">&quot;_1&quot;</span>;</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;菜品修改成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改菜品&#x2F;套餐状态函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">stop</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> status, <span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    LambdaUpdateWrapper&lt;Dish&gt; luw = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    luw.in(Dish::getId, ids);</span><br><span class="line">    luw.set(Dish::getStatus, status);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增redis清除缓存</span></span><br><span class="line">    LambdaQueryWrapper&lt;Dish&gt; lqw = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    lqw.in(Dish::getId, ids);</span><br><span class="line">    <span class="keyword">for</span> (Dish dish : dishService.list(lqw)) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;dish_&quot;</span> + dish.getCategoryId() + <span class="string">&quot;_1&quot;</span>;</span><br><span class="line">        redisTemplate.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    dishService.update(luw);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;状态更新成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>由于没有编写套餐数据的缓存，所以可以用菜品数据和套餐数据做对比</p>
<ul>
<li>先手动点击一遍所有的分类，让Redis缓存（包括菜品分类和套餐分类）。清空控制台输出，方便后续对比</li>
<li>再次点击菜品分类，控制台日志不会输出SQL语句的日志</li>
<li>但是每次点击套餐分类时，控制台都会输出SQL语句的日志</li>
<li>当对菜品数据进行任意形式的修改(修改&#x2F;添加&#x2F;删除&#x2F;改状态)时，缓存数据将被清理，同时重新查询，避免出现脏数据</li>
</ul>
<h2 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li>SpringCache是一个框架，实现了基本注解的缓存功能，只需要<strong>添加一个注解</strong>，就能实现缓存功能</li>
<li>SpringCache提供了一层抽象，底层可以切换不同的cache实现，具体就是通过CacheManager接口来统一不同的缓存技术</li>
<li>针对不同的缓存技术，需要实现不同的CacheManager</li>
</ul>
<table>
<thead>
<tr>
<th align="left">CacheManger</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">EhCacheCacheManager</td>
<td align="left">使用EhCache作为缓存技术</td>
</tr>
<tr>
<td align="left">GuavaCacheManager</td>
<td align="left">使用Google的GuavaCache作为缓存技术</td>
</tr>
<tr>
<td align="left">RedisCacheManager</td>
<td align="left">使用Redis作为缓存技术</td>
</tr>
</tbody></table>
<h3 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h3><table>
<thead>
<tr>
<th align="left">注解</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@EnableCaching</td>
<td align="left">开启缓存注解功能</td>
</tr>
<tr>
<td align="left">@Cacheable</td>
<td align="left">在方法执行前spring先查看缓存中是否有数据。如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</td>
</tr>
<tr>
<td align="left">@CachePut</td>
<td align="left">将方法的返回值放到缓存中</td>
</tr>
<tr>
<td align="left">@CacheEvict</td>
<td align="left">将一条或者多条数据从缓存中删除</td>
</tr>
</tbody></table>
<blockquote>
<p>这里以<code>@Cacheable</code>为例，其余两个用法一致，更详细用法可以点击注解到源码中查看</p>
</blockquote>
<p><code>@Cacheable</code>根据方法的请求参数<strong>对其结果进行缓存</strong>。在方法执行前spring先查看缓存中是否有数据。如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</p>
<ul>
<li><p>格式：<code>@Cacheable(value= , key= , condition= )</code></p>
<ul>
<li><code>value</code>是缓存的名称，不能为空，每个缓存名称下面可以有多个key</li>
<li><code>key</code>是缓存数据的key，可以为空，指定需要按照SpEL表达式编写；缺省按照方法的所有参数进行组合。</li>
<li><code>condition</code>是缓存的条件，可以为空，使用SpEL编写，返回true或者false，只有为true 才进行缓存</li>
</ul>
<blockquote>
<p>具体key和condition中SpEL中可以写什么，可以直接ctrl点击注解，在其上方注释中查看</p>
</blockquote>
</li>
<li><p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以传入的id为key，以返回值user为value缓存，缓存条件是返回值不为空</span></span><br><span class="line"><span class="meta">@Cacheable(value=&quot;wzyCache&quot; , key=&quot;#id&quot;， condition=&quot;#result != null&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以user的id为key，将返回值user作为value缓存</span></span><br><span class="line"><span class="meta">@Cacheable(value=&quot;wzyCache&quot; , key=&quot;#user.id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    userService.save(user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同样的方法key还可以写为：<code>key=#p0.id</code>、<code>key=root.args[0].id</code> 等作用都一致。</p>
</li>
</ul>
<h3 id="使用方式"><a href="#使用方式" class="headerlink" title="使用方式"></a>使用方式</h3><ul>
<li><p>导入依赖坐标</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>配置application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">time-to-live:</span> <span class="number">3600000</span> <span class="comment">#设置存活时间为一小时，如果不设置，则一直存活</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>启动类</strong>上使用<code>@EnableCaching</code>开启缓存技术支持。</p>
</li>
<li><p>然后在controller方法上标注<code>@Cacheable</code>、<code>@CacheEvict</code>等注解。</p>
</li>
</ul>
<h2 id="缓存套餐数据"><a href="#缓存套餐数据" class="headerlink" title="缓存套餐数据"></a>缓存套餐数据</h2><h3 id="实现思路-2"><a href="#实现思路-2" class="headerlink" title="实现思路"></a>实现思路</h3><p>前面我们已经实现了移动端查看套餐的功能，对应SetmealController中的list方法。此方法会根据前端提交的查询条件进行数据库查询操作。在高并发的情况下，频繁查询数据库会导致系统性能下降，服务端响应时间增强。现在需要对此方法进行缓存优化，提高系统性能</p>
<p>具体实现思路如下：</p>
<ol>
<li>导入Spring Cache和Redis相关的Maven坐标</li>
<li>在application.yml中配置缓存数据的过期时间</li>
<li>在启动类上加上<code>@EnableCaching</code>注解，开启缓存注解功能</li>
<li>在SetmealController的list方法上加上<code>@Cacheable</code>注解</li>
<li>在SetmealController的save、delete的方法上加上<code>CacheEvict</code>注解</li>
</ol>
<h3 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h3><ol>
<li><p>首先进行工作准备：maven依赖坐标导入、配置文件添加redis和缓存、启动类标注<code>@EnableCaching</code></p>
</li>
<li><p><code>SetmealController</code>list方法上加上<code>@Cacheale</code>注解</p>
<blockquote>
<p>在方法执行前，Spring先查看缓存中是否有数据；如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@Cacheable(value = &quot;setmealCache&quot;,key = &quot;#setmeal.categoryId+&#x27;_&#x27;+#setmeal.status&quot;)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Setmeal setmeal)</span>&#123;</span><br><span class="line">    <span class="comment">//条件构造器</span></span><br><span class="line">    LambdaQueryWrapper&lt;Setmeal&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//添加条件</span></span><br><span class="line">    queryWrapper.eq(setmeal.getCategoryId() != <span class="literal">null</span>, Setmeal::getCategoryId, setmeal.getCategoryId());</span><br><span class="line">    queryWrapper.eq(setmeal.getStatus() != <span class="literal">null</span>, Setmeal::getStatus, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//排序</span></span><br><span class="line">    queryWrapper.orderByDesc(Setmeal::getUpdateTime);</span><br><span class="line">    List&lt;Setmeal&gt; setmealList = setmealService.list(queryWrapper);</span><br><span class="line">    <span class="keyword">return</span> R.success(setmealList);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>此时因为方法返回的是R封装的数据，直接执行会报错:<code>DefaultSerializer requires a Serializable payload but received an object of type</code></p>
<p>这是因为要缓存的JAVA对象必须实现<code>Serializable</code>接口，因为<strong>Spring会先将对象序列化再存入Redis</strong>，将缓存实体类继承<code>Serializable</code>。所以这里将R类实现<code>Serializable</code>接口</p>
</blockquote>
</li>
<li><p><code>SetmealController</code>save、update和status方法，加入清理缓存的逻辑，加上<code>@CacheEvict</code>注解</p>
<ul>
<li><p><code>save</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="comment">//设置allEntries为true，清空缓存名称为setmealCache的所有缓存</span></span><br><span class="line"><span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDto setmealDto)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;新建套餐:&#123;&#125;&quot;</span>,setmealDto.toString());</span><br><span class="line">    setmealService.saveWithDish(setmealDto);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;新建成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>delete</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;删除套餐的id：&#123;&#125;&quot;</span>,ids);</span><br><span class="line">    setmealService.removeWithDish(ids);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;删除成功&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>status</code>方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@CacheEvict(value = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> R&lt;String&gt; <span class="title function_">stop</span><span class="params">(<span class="meta">@PathVariable</span> <span class="type">int</span> status, <span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;套餐状态：&#123;&#125;，套餐ids：&#123;&#125;&quot;</span>,status,ids);</span><br><span class="line"></span><br><span class="line">    LambdaUpdateWrapper&lt;Setmeal&gt; luw = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">    luw.in(Setmeal::getId, ids);</span><br><span class="line">    luw.set(Setmeal::getStatus, status);</span><br><span class="line">    setmealService.update(luw);</span><br><span class="line">    <span class="keyword">return</span> R.success(<span class="string">&quot;修改销售状态成功&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<hr>
<h1 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h1><h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><ul>
<li>目前我们所有的读和写的压力都是由一台数据库来承担，如果数据库服务器磁盘损坏，则数据会丢失（没有备份）</li>
<li>解决这个问题，就可以用MySQL的主从复制，写操作交给主库，读操作交给从库，同时将主库写入的内容，同步到从库中</li>
</ul>
<p><img src="/2023/07/02/ReggieOptim/image-20230709113111583.png" alt="image-20230709113111583"></p>
<p><img src="/2023/07/02/ReggieOptim/image-20230709113307624.png" alt="image-20230709113307624"></p>
<h2 id="MySQL主从复制"><a href="#MySQL主从复制" class="headerlink" title="MySQL主从复制"></a>MySQL主从复制</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>MySQL主从复制是一个异步的复制过程，底层是基于Mysql数据库自带的<strong>二进制日志</strong>功能。就是一台或多台NysQL数据库（slave，即<strong>从库</strong>）从另一台MySQL数据库(master，即<strong>主库</strong>）进行日志的复制然后再解析日志并应用到自身，最终实现从库的数据和主库的数据保持一致。MySQL主从复制是MySQL数据库自带功能，无需借助第三方工具。</p>
<p>MySQL复制过程分成三步:</p>
<ol>
<li><code>maste</code>r将改变记录到二进制日志(<code>binary log</code>)</li>
<li><code>slave</code>将<code>master</code>的<code>binary log</code>拷贝到它的中继日志(<code>relay log</code>)</li>
<li><code>slave</code>重做中继日志中的事件，将改变应用到自己的数据库中</li>
</ol>
<p><img src="/2023/07/02/ReggieOptim/634f9fb216f2c2beb1307161.jpg" alt="img"></p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>前置条件：准备好两台服务器，分别安装MySQL并启动服务成功。</p>
<h4 id="虚拟机克隆"><a href="#虚拟机克隆" class="headerlink" title="虚拟机克隆"></a>虚拟机克隆</h4><blockquote>
<p>这里我通过克隆虚拟机实现两台服务器，教程：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_36665875/article/details/106350796">VMware 虚拟机克隆详细教程</a></p>
</blockquote>
<ol>
<li><p>首先通过克隆复制原本的虚拟机环境。</p>
</li>
<li><p>然后使用<code>ip addr</code>命令获取两个虚拟的IP地址，便于远程连接</p>
<ul>
<li><code>192.168.186.128</code></li>
<li><code>192.168.186.129</code></li>
</ul>
</li>
<li><p>修改克隆机的MySQL的uuid</p>
<ul>
<li><p>执行SQL语句，记住生成的uuid</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">select</span> uuid();</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> uuid()                               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="operator">|</span> d570dfcf<span class="number">-1e2</span>b<span class="number">-11</span>ee<span class="operator">-</span>a470<span class="number">-000</span>c29495816 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看配置文件目录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;datadir&#x27;</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> Variable_name <span class="operator">|</span> <span class="keyword">Value</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----------------+</span></span><br><span class="line"><span class="operator">|</span> datadir       <span class="operator">|</span> <span class="operator">/</span>var<span class="operator">/</span>lib<span class="operator">/</span>mysql<span class="operator">/</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">---------------+-----------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.12</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>编辑配置文件目录：<code>vi /var/lib/mysql/auto.cnf</code>，修改uuid为刚刚我们生成的uuid</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[auto]</span><br><span class="line">server-uuid=d570dfcf-1e2b-11ee-a470-000c29495816</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启服务：<code>service mysqld restart</code></p>
</li>
</ul>
</li>
</ol>
<h4 id="配置主从服务器"><a href="#配置主从服务器" class="headerlink" title="配置主从服务器"></a>配置主从服务器</h4><p><strong>主库配置：</strong></p>
<ol>
<li><p>修改MySQL数据库的配置文件<code>vim /etc/my.conf</code></p>
<p>找到<code>[mysqld]</code>，在下面插入两行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">log_bin=mysql-bin #[必须]启用二进制日志</span><br><span class="line">server-id=128 #[必须]服务器唯一ID,只需要确保其id是唯一的就好</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启mysql服务<code>systemctl restart mysqld</code></p>
</li>
<li><p>登录Mysql数据库，<code>mysql -uroot -p</code>。执行下面的SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> replication slave <span class="keyword">on</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">to</span> <span class="string">&#x27;wzy&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified <span class="keyword">by</span> <span class="string">&#x27;Root@123456&#x27;</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面的SQL的作用是创建一个用户<code>wzy</code>,密码为<code>Root@123456</code>，并且给<code>wzy</code>用户授予<code>replication slave</code>权限。常用于建立复制时所需要用到的用户权限，也就是<code>slave</code>必须被<code>master</code>授权具有该权限的用户，才能通过该用户复制，这是因为主库和从库之间需要互相通信，处于安全考虑，只有通过验证的从库才能从主库中读取二进制数据。</p>
</blockquote>
</li>
<li><p>登录Mysql数据库，执行下述SQL：<code>show master status</code>，记录结果中File和Position的值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">show</span> master status;</span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> File             <span class="operator">|</span> Position <span class="operator">|</span> Binlog_Do_DB <span class="operator">|</span> Binlog_Ignore_DB <span class="operator">|</span> Executed_Gtid_Set <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="operator">|</span> mysql<span class="operator">-</span>bin<span class="number">.000001</span> <span class="operator">|</span>      <span class="number">436</span> <span class="operator">|</span>              <span class="operator">|</span>                  <span class="operator">|</span>                   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------------------+----------+--------------+------------------+-------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="type">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面sql的作用是查看Master的状态，<strong>执行完此SQL后不要再执行任何操作</strong>，否则上述内容就会发生变化。</p>
</blockquote>
</li>
</ol>
<p><strong>从库配置：</strong></p>
<ol>
<li><p>修改MySQL数据库的配置文件<code>/etc/my.cnf</code></p>
<p>找到[mysqld]，在下面插入一行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">server-id=127 #[必须]服务器唯一ID,只需要确保其id是唯一的就好</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启mysql服务<code>systemctl restart mysqld</code></p>
</li>
<li><p>登录到Mysql数据库，执行下面SQL</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">change master <span class="keyword">to</span> master_host<span class="operator">=</span><span class="string">&#x27;192.168.186.128&#x27;</span>,master_user<span class="operator">=</span><span class="string">&#x27;wzy&#x27;</span>,master_password<span class="operator">=</span><span class="string">&#x27;Root@123456&#x27;</span>,master_log_file<span class="operator">=</span><span class="string">&#x27;mysql-bin.000001&#x27;</span>,master_log_pos<span class="operator">=</span><span class="number">436</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">start</span> slave;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如果执行第一句报错，可能是该虚拟机之前配置过slave，执行<code>stop slave</code>即可</p>
</blockquote>
</li>
<li><p>登录Mysql数据库,执行SQL：<code>show slave status \G;</code>，查看从库的状态（这里<code>\G</code>是竖排查看）</p>
<p>此时会出现一堆内容，着重看下面三个内容，如果显示为如下状态则成功</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">   Slave_IO_State   : Waiting <span class="keyword">for</span> master <span class="keyword">to</span> send event</span><br><span class="line">   Slave_IO_Running : Yes</span><br><span class="line">   Slave_SQL_Running: Yes</span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> 在上一步中，我得到的结果并不和上面一致，根据弹幕大佬指点，需要修改克隆机的MySQL的uuid，这一步放在虚拟机配置部分。修改后再使用上述命令得到如下：</span><br><span class="line"></span><br><span class="line">   <span class="operator">!</span>[image<span class="number">-20230709154519132</span>](image<span class="number">-20230709154519132.</span>png)</span><br><span class="line"></span><br><span class="line">### 测试</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 这里我们通过Navicate连接两个虚拟机的数据库：</span><br><span class="line"></span><br><span class="line">   <span class="operator">!</span>[image<span class="number">-20230709154943347</span>](image<span class="number">-20230709154943347.</span>png)</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> 我们在主库新建一个数据库，并且创建一个`<span class="keyword">user</span>`表，然后刷新从库，发现也出现了该数据库和其下面的表。并且修改主库，对应从库也会发生变化</span><br><span class="line"></span><br><span class="line">   <span class="operator">!</span>[image<span class="number">-20230709155326829</span>](image<span class="number">-20230709155326829.</span>png)</span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line">## 读写分离案例</span><br><span class="line"></span><br><span class="line">### 背景</span><br><span class="line"></span><br><span class="line">面对日益增加的系统访问量，数据库的吞吐量面临着巨大的瓶颈。对于同一时刻有<span class="operator">*</span><span class="operator">*</span>大量并发读操作<span class="operator">*</span><span class="operator">*</span>和<span class="operator">*</span><span class="operator">*</span>较少的写操作<span class="operator">*</span><span class="operator">*</span>类型的应用系统来说，将数据库拆分为`主库`和`从库`。`主库`主要负责处理事务性的<span class="operator">*</span><span class="operator">*</span>增删改<span class="operator">*</span><span class="operator">*</span>操作。`从库`主要负责<span class="operator">*</span><span class="operator">*</span>查询<span class="operator">*</span><span class="operator">*</span>操作</span><br><span class="line"></span><br><span class="line">这样就能有效避免由数据更新导致的行锁，使得整个系统的查询性能得到极大的改善</span><br><span class="line"></span><br><span class="line">### Sharding<span class="operator">-</span>JDBC介绍</span><br><span class="line"></span><br><span class="line">Sharding<span class="operator">-</span>JDBC定位为轻量级的Java框架，在Java的JDBC层提供额外的服务，它使得客户端直连数据库，以jar包形式提供服务，无需额外部署和依赖，可理解为增强版的JDBC驱动，完全兼容JDBC和各种ORM框架</span><br><span class="line"></span><br><span class="line">使用Sharding<span class="operator">-</span>JDBC可以在程序中轻松的实现数据库读写分离</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> 适用于任何基于JDBC的ORM框架，如：JPA、Hibernate、Mybatis、Spring JDBC Template或直接使用JDBC</span><br><span class="line"><span class="operator">-</span> 支持任何第三方的数据库连接池，如：DBCP、C3P0、BoneCP、Druid等</span><br><span class="line"><span class="operator">-</span> 支持任意实现JDBC规范的数据库，目前支持MySQL、Oracle、SQLServer、PostgreSQL</span><br><span class="line"></span><br><span class="line">### 入门案例</span><br><span class="line"></span><br><span class="line">使用Sharding<span class="operator">-</span>JDBC框架的步骤：</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span> 导入对应的maven坐标</span><br><span class="line"></span><br><span class="line">   ```xml</span><br><span class="line">   <span class="operator">&lt;</span>dependency<span class="operator">&gt;</span></span><br><span class="line">       <span class="operator">&lt;</span>groupId<span class="operator">&gt;</span>org.apache.shardingsphere<span class="operator">&lt;</span><span class="operator">/</span>groupId<span class="operator">&gt;</span></span><br><span class="line">       <span class="operator">&lt;</span>artifactId<span class="operator">&gt;</span>sharding<span class="operator">-</span>jdbc<span class="operator">-</span>spring<span class="operator">-</span>boot<span class="operator">-</span>starter<span class="operator">&lt;</span><span class="operator">/</span>artifactId<span class="operator">&gt;</span></span><br><span class="line">       <span class="operator">&lt;</span>version<span class="operator">&gt;</span><span class="number">4.0</span><span class="number">.0</span><span class="operator">-</span>RC1<span class="operator">&lt;</span><span class="operator">/</span>version<span class="operator">&gt;</span></span><br><span class="line">   <span class="operator">&lt;</span><span class="operator">/</span>dependency<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在配置文件中添加读写分离规则</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span></span><br><span class="line">        <span class="string">master,slave</span></span><br><span class="line">      <span class="comment"># 主数据源</span></span><br><span class="line">      <span class="attr">master:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.186.128:3306/reggie?serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="comment"># 从数据源</span></span><br><span class="line">      <span class="attr">slave:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.186.129:3306/reggie?serverTimezone=UTC</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">masterslave:</span></span><br><span class="line">      <span class="comment"># 读写分离配置</span></span><br><span class="line">      <span class="attr">load-balance-algorithm-type:</span> <span class="string">round_robin</span> <span class="comment">#负载均衡</span></span><br><span class="line">      <span class="comment"># 最终的数据源名称</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dataSource</span></span><br><span class="line">      <span class="comment"># 主库数据源名称</span></span><br><span class="line">      <span class="attr">master-data-source-name:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment"># 从库数据源名称列表，多个逗号分隔</span></span><br><span class="line">      <span class="attr">slave-data-source-names:</span> <span class="string">slave</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">sql:</span></span><br><span class="line">        <span class="attr">show:</span> <span class="literal">true</span> <span class="comment">#开启SQL显示，默认false</span></span><br><span class="line">  <span class="comment"># 解决冲突</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在配置文件中配置允许bean定义覆盖配置项</p>
<blockquote>
<p>在前面配置完成后执行会报错，这是因为Sharding-JDBC中配置数据源和以前导入的德鲁伊连接池发生冲突，二者都想要创建数据源，所以在配置文件中加上上面最后两句，从而让bean定义并覆盖，从而解决冲突</p>
</blockquote>
</li>
</ol>
<h2 id="瑞吉项目实现"><a href="#瑞吉项目实现" class="headerlink" title="瑞吉项目实现"></a>瑞吉项目实现</h2><h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><p>首先在linux主服务器上创建数据库<code>reggie</code>，然后将本地的reggie的数据库导出为sql文件，在主服务器上进行导入即可</p>
<ul>
<li><p>本地导出sql文件</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230709195334557.png" alt="image-20230709195334557"></p>
</li>
<li><p>远程导入sql文件</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230709200107819.png" alt="image-20230709200107819"></p>
<blockquote>
<p>注意：此时直接导入会失败，这是因为远程的Mysql版本为5.7，而本地使用的是8.0，会有部分差别。需要将<code>COLLATE utf8mb4_0900_ai_ci NULL </code>所有内容删掉即可</p>
</blockquote>
</li>
<li><p>此时远程主从服务器上都有了reggie的数据</p>
</li>
</ul>
<h3 id="流程实现"><a href="#流程实现" class="headerlink" title="流程实现"></a>流程实现</h3><ol>
<li><p>首先在Git上创建一个新的分支<code>v1.1</code>，便于后续维护</p>
</li>
<li><p>导入Sharding-JDBC的maven坐标依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0-RC1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>修改配置文件，添加读写分离部分的内容</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">shardingsphere:</span></span><br><span class="line">    <span class="attr">datasource:</span></span><br><span class="line">      <span class="attr">names:</span></span><br><span class="line">        <span class="string">master,slave</span></span><br><span class="line">      <span class="comment"># 主数据源</span></span><br><span class="line">      <span class="attr">master:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.186.128:3306/reggie?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">      <span class="comment"># 从数据源</span></span><br><span class="line">      <span class="attr">slave:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">        <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.186.129:3306/reggie?characterEncoding=utf-8</span></span><br><span class="line">        <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">masterslave:</span></span><br><span class="line">      <span class="comment"># 读写分离配置</span></span><br><span class="line">      <span class="attr">load-balance-algorithm-type:</span> <span class="string">round_robin</span> <span class="comment">#负载均衡</span></span><br><span class="line">      <span class="comment"># 最终的数据源名称</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">dataSource</span></span><br><span class="line">      <span class="comment"># 主库数据源名称</span></span><br><span class="line">      <span class="attr">master-data-source-name:</span> <span class="string">master</span></span><br><span class="line">      <span class="comment"># 从库数据源名称列表，多个逗号分隔</span></span><br><span class="line">      <span class="attr">slave-data-source-names:</span> <span class="string">slave</span></span><br><span class="line">    <span class="attr">props:</span></span><br><span class="line">      <span class="attr">sql:</span></span><br><span class="line">        <span class="attr">show:</span> <span class="literal">true</span> <span class="comment">#开启SQL显示，默认false</span></span><br><span class="line">  <span class="comment"># 解决冲突</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-bean-definition-overriding:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># redis缓存</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">time-to-live:</span> <span class="number">3600000</span> <span class="comment">#设置存活时间为一小时，如果不设置，则一直存活</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">assign_id</span></span><br><span class="line"></span><br><span class="line"><span class="attr">reggie:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">D:\IDEA\imgs\</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：此时部分内容会爆红，但是不影响启动。</p>
</blockquote>
</li>
<li><p>注意开启<code>redis-server</code></p>
</li>
<li><p>然后我这里直接启动项目，会报druid相关的错误。进行下述修改后成功启动项目。根据弹幕的建议，将maven依赖中的druid依赖进行修改。</p>
<ul>
<li>修改前</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改后</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>然后实际的效果就是，新增、修改时候，会显示是在操作<code>master</code>服务器，查询时会显示在操作<code>slave</code>服务器。并且二者的数据库中都出现新增的内容。</p>
<ul>
<li><code>master</code>新增数据</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2023-07-09 20:54:35.174  INFO 16852 --- [nio-8080-exec-7] ShardingSphere-SQL : Rule Type: master-slave</span><br><span class="line">2023-07-09 20:54:35.174  INFO 16852 --- [nio-8080-exec-7] ShardingSphere-SQL : SQL: INSERT INTO employee  ( id,username,name,password,phone,sex,id_number,create_time,update_time,create_user,update_user )  VALUES  ( ?,?,?,?,?,?,?,?,?,?,? ) ::: DataSources: master</span><br></pre></td></tr></table></figure>

<ul>
<li><code>slave</code>查询数据</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2023</span>-<span class="number">07</span>-09 <span class="number">20</span>:<span class="number">54</span>:<span class="number">35.324</span>  INFO <span class="number">16852</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">9</span>] ShardingSphere-SQL : Rule Type: master-slave</span><br><span class="line"><span class="number">2023</span>-<span class="number">07</span>-09 <span class="number">20</span>:<span class="number">54</span>:<span class="number">35.325</span>  INFO <span class="number">16852</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">9</span>] ShardingSphere-SQL : SQL: SELECT  id,username, name,password,phone,sex,id_number,status,create_time,update_time,create_user,update_user  FROM employee ORDER BY update_time DESC LIMIT ? ::: DataSources: slave</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="介绍-2"><a href="#介绍-2" class="headerlink" title="介绍"></a>介绍</h3><p>Nginx是一款<strong>轻量级的Web&#x2F;反向代理服务器</strong>以及<strong>电子邮件(IMAP&#x2F;POP3)代理服务器</strong>，其特点是占有内存少，并发能力强。事实上Nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用Nginx的网站有：百度、京东、新浪、网易、腾讯、淘宝等。</p>
<p>Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Pam6nep）开发的，第一个公开版本0.1.0发布于2004年10月4日。官网：<a target="_blank" rel="noopener" href="https://nginx.org/">https://nginx.org/</a></p>
<h3 id="下载和安装"><a href="#下载和安装" class="headerlink" title="下载和安装"></a>下载和安装</h3><p>官网下载链接：<a target="_blank" rel="noopener" href="https://nginx.org/en/download.html">https://nginx.org/en/download.html</a></p>
<p>安装过程：</p>
<ol>
<li><p>首先安装依赖包：<code>yum -y install gcc pcre-devel zlib-devel openssl openssl-devel</code></p>
</li>
<li><p>下载Nginx安装包wget：<code>wget https://nginx.org/download/nginx-1.24.0.tar.gz</code></p>
<ul>
<li>wget是从网络下载资源的命令。如果没有安装wget，执行：<code>yum install wget</code></li>
</ul>
</li>
<li><p>解压：<code>tar -zxvf nginx-1.24.0.tar.gz -C /usr/local/</code></p>
</li>
<li><p>进入解压后的文件夹：<code>cd /usr/local/nginx-1.24.0/</code></p>
</li>
<li><p>创建安装文件夹：<code>mkdir /usr/local/nginx </code></p>
</li>
<li><p>指定安装路径并进行检查工作：<code>./configure --prefix=/usr/local/nginx</code>（此时还没安装，只是完成安装前的检查工作）</p>
</li>
<li><p>编译并安装：<code>make &amp;&amp; make install</code></p>
</li>
</ol>
<h3 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h3><p>重点目录&#x2F;文件：</p>
<ul>
<li><code>conf/nginx.conf</code>：nginx配置文件</li>
<li><code>html</code>：存放静态文件(html、css、Js等)</li>
<li><code>logs</code>：日志目录，存放日志文件</li>
<li><code>sbin/nginx</code>：二进制文件，用于启动、停止Nginx服务</li>
</ul>
<p>显示目录树形结构：</p>
<ul>
<li><p>在目录下使用<code>tree</code>命令，可以直观获取目录树状结构。如果没有安装此命令，需要执行：<code>yum install tree</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">├── conf                             &lt;-- Nginx配置文件</span><br><span class="line">│   ├── fastcgi.conf</span><br><span class="line">│   ├── fastcgi.conf.default</span><br><span class="line">│   ├── fastcgi_params</span><br><span class="line">│   ├── fastcgi_params.default</span><br><span class="line">│   ├── koi-utf</span><br><span class="line">│   ├── koi-win</span><br><span class="line">│   ├── mime.types</span><br><span class="line">│   ├── mime.types.default</span><br><span class="line">│   ├── nginx.conf                    &lt;-- 经常操作的配置文件</span><br><span class="line">│   ├── nginx.conf.default</span><br><span class="line">│   ├── scgi_params</span><br><span class="line">│   ├── scgi_params.default</span><br><span class="line">│   ├── uwsgi_params</span><br><span class="line">│   ├── uwsgi_params.default</span><br><span class="line">│   └── win-utf</span><br><span class="line">├── html                              &lt;-- 存放静态文件，后期部署项目的静态文件放在这</span><br><span class="line">│   ├── 50x.html</span><br><span class="line">│   └── index.html                    &lt;-- 提供的默认的页面</span><br><span class="line">├── logs                              &lt;-- 日志目录，由于Nginx还未使用，所以现在还没有日志文件</span><br><span class="line">└── sbin</span><br><span class="line">    └── nginx</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><ul>
<li><p><strong>查看版本命令</strong>：进入sbin目录，输入<code>./nginx -v</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]<span class="comment"># ./nginx -v</span></span><br><span class="line">nginx version: nginx/1.24.0</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>检查配置文件正确性</strong>：进入sbin目录，输入<code>./nginx -t</code>，如果有错误会报错，而且会记录日志</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]<span class="comment"># ./nginx -t</span></span><br><span class="line">nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /usr/local/nginx/conf/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>启动与停止</strong>：</p>
<ul>
<li><p>启动：进入sbin目录，输入<code>./nginx</code>，启动完成后查看进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]<span class="comment"># ./nginx</span></span><br><span class="line">[root@localhost sbin]<span class="comment"># ps -ef | grep nginx</span></span><br><span class="line">root      31524      1  0 11:35 ?        00:00:00 nginx: master process ./nginx</span><br><span class="line">nobody    31525  31524  0 11:35 ?        00:00:00 nginx: worker process</span><br><span class="line">root      31763   7447  0 11:35 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure>

<blockquote>
<p>启动后，可以通过访问ip地址80端口查看nginx主页，但是首先需要关闭80端口的防火墙</p>
</blockquote>
</li>
<li><p>停止：输入<code>./nginx -s stop</code>，停止服务后再次查看进程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost sbin]<span class="comment"># ./nginx -s stop</span></span><br><span class="line">[root@localhost sbin]<span class="comment"># ps -ef | grep nginx</span></span><br><span class="line">root      33446   7447  0 11:36 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>重新加载配置文件</strong>：当修改Nginx配置文件后，需要重新加载才能生效，可以使用下面命令重新加载配置文件：<code>./nginx -s reload</code>。</p>
</li>
</ul>
<p>上面的所有命令，都需要在sbin目录下才能运行，比较麻烦，所以可以<strong>将Nginx的二进制文件配置到环境变量中</strong>，这样无论在哪个目录下，都能使用上面的命令。</p>
<ol>
<li><p>使用<code>vim /etc/profile</code>命令打开配置文件，并配置环境变量，保存并退出</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- PATH=$JAVA_HOME/bin:$PATH</span></span><br><span class="line"><span class="addition">+ PATH=/usr/local/nginx/sbin:$JAVA_HOME/bin:$PATH</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>重新加载配置文件，使用<code>source /etc/profile</code>命令。</p>
</li>
</ol>
<p>此时在任意位置输入<code>nginx</code>即可启动服务，<code>nginx -s stop</code>即可停止服务</p>
<h2 id="配置文件结构"><a href="#配置文件结构" class="headerlink" title="配置文件结构"></a>配置文件结构</h2><p>Nginx配置文件(conf&#x2F;nginx.conf)整体分为三部分</p>
<ul>
<li><p><strong>全局块</strong>         和Nginx运行相关的全局配置</p>
</li>
<li><p><strong>events块</strong>    和网络连接相关的配置</p>
</li>
<li><p><strong>http块</strong>        代理、缓存、日志记录、虚拟主机配置</p>
<blockquote>
<p>http块中可以配置多个Server块，每个Server块中可以配置多个location块</p>
</blockquote>
<ul>
<li>http全局块</li>
<li>Server块<ul>
<li>Server全局块</li>
<li>location块</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>niginx.conf</code>文件如下：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">worker_processes</span>  <span class="string">1;                              &lt;-- 全局块,event之前的</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">events</span> <span class="string">&#123;                                          &lt;-- events块</span></span><br><span class="line">    <span class="attr">worker_connections</span>  <span class="string">1024;  </span></span><br><span class="line"><span class="attr">&#125;</span>  <span class="string"></span></span><br><span class="line">  </span><br><span class="line"><span class="attr">http</span> <span class="string">&#123;                                            &lt;-- http块</span></span><br><span class="line">    <span class="attr">include</span>       <span class="string">mime.types;                     &lt;-- http全局块</span></span><br><span class="line">    <span class="attr">default_type</span>  <span class="string">application/octet-stream;  </span></span><br><span class="line">    <span class="attr">sendfile</span>        <span class="string">on;  </span></span><br><span class="line">    <span class="attr">keepalive_timeout</span>  <span class="string">65;  </span></span><br><span class="line">  </span><br><span class="line">    <span class="attr">server</span> <span class="string">&#123;                                      &lt;-- Server块</span></span><br><span class="line">        <span class="attr">listen</span>       <span class="string">80;                          &lt;-- Server全局块</span></span><br><span class="line">        <span class="attr">server_name</span>  <span class="string">localhost;  </span></span><br><span class="line">        </span><br><span class="line">        <span class="attr">location</span> <span class="string">/ &#123;                              &lt;-- location块</span></span><br><span class="line">            <span class="attr">root</span>   <span class="string">html;</span></span><br><span class="line">            <span class="attr">index</span>  <span class="string">index.html index.htm;</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br><span class="line">        <span class="attr">error_page</span>   <span class="string">500 502 503 504  /50x.html;</span></span><br><span class="line">        <span class="attr">location</span> = <span class="string">/50x.html &#123;</span></span><br><span class="line">            <span class="attr">root</span>   <span class="string">html;</span></span><br><span class="line">        <span class="attr">&#125;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="具体应用"><a href="#具体应用" class="headerlink" title="具体应用"></a>具体应用</h2><h3 id="部署静态资源"><a href="#部署静态资源" class="headerlink" title="部署静态资源"></a>部署静态资源</h3><p>Nginx可以作为静态web服务器来部署静态资源。静态资源指在服务端真实存在并且能够直接展示的一些文件，比如常见的html页面、css文件、js文件、图片、视频等资源。</p>
<p>相对于Tomcat，Nginx<strong>处理静态资源的能力更加高效</strong>，所以在生产环境下，一般都会将静态资源部署到Nginx中。</p>
<p>将静态资源部署到Nginx非常简单，只需要<strong>将文件复制到Nginx安装目录下的html目录中</strong>即可。</p>
<h3 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h3><h4 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h4><p><strong>正向代理：</strong></p>
<ul>
<li><p>正向代理是一个位于客户端和原始服务器（origin server)之间的服务器，为了从原始服务器取得内容，客户端向代理发送一个请求并指定目标（原始服务器），然后代理向原始服务器转交请求并将获得的内容返回给客户端。</p>
</li>
<li><p>正向代理的典型用途是为在防火墙内的局域网客户端提供访问Internet的途径。</p>
</li>
<li><p>正向代理一般是<strong>在客户端设置代理服务器</strong>，通过代理服务器转发请求，最终访问到目标服务器。（客户端知道代理服务器的存在）</p>
</li>
</ul>
<p><img src="/2023/07/02/ReggieOptim/image-20230710134658811.png" alt="image-20230710134658811"></p>
<p><strong>反向代理</strong></p>
<ul>
<li>反向代理服务器位于用户与目标服务器之间，但是对于用户而言，反向代理服务器就相当于目标服务器，即用户直接访问反向代理服务器就可以获得目标服务器的资源，反向代理服务器负责将请求转发给目标服务器。</li>
<li>用户不需要知道目标服务器的地址，也<strong>无须在用户端作任何设定</strong>。（客户端并不知道反向代理服务器的存在）</li>
</ul>
<p><img src="/2023/07/02/ReggieOptim/image-20230710134813300.png" alt="image-20230710134813300"></p>
<p><strong>二者作用</strong>：</p>
<ul>
<li>正向代理<ul>
<li>访问原来无法访问的资源，如google</li>
<li>可以做缓存，加速访问资源</li>
<li>对客户端访问授权，上网进行认证</li>
<li>代理可以记录用户访问记录（上网行为管理），对外隐藏用户信息</li>
</ul>
</li>
<li>反向代理<ul>
<li>保证内网的安全，阻止web攻击，大型网站，通常将反向代理作为公网访问地址，Web服务器是内网。</li>
<li>负载均衡，通过反向代理服务器来优化网站的负载。</li>
</ul>
</li>
</ul>
<p><strong>二者区别与联系</strong>：</p>
<ul>
<li>正向代理即是客户端代理, 代理客户端, <strong>服务端不知道实际发起请求的客户端</strong>.<br>反向代理即是服务端代理, 代理服务端, <strong>客户端不知道实际提供服务的服务端</strong>.</li>
<li>正向代理中，proxy和client同属一个LAN，对server透明。                                                                                                                           反向代理中，proxy和server同属一个LAN，对client透明。</li>
</ul>
<h4 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h4><blockquote>
<p>首先假定两个服务器，一个是反向代理服务器：192.168.186.128，一个是web服务器：192.168.186.129</p>
</blockquote>
<ul>
<li><p>首先修改反向代理服务器的配置文件：<code>nginx.conf</code></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">listen</span>       <span class="string">82;</span></span><br><span class="line">    <span class="attr">server_name</span>  <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">location</span> <span class="string">/ &#123;</span></span><br><span class="line">        <span class="attr">proxy_pass</span> <span class="string">http://http://192.168.186.129:8080;  # 反向代理配置，将请求转发到指定服务</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>此时的访问流程为：客户端–&gt;<code>192.168.186.128:82</code>–&gt;<code>192.168.186.129:8080</code></p>
<blockquote>
<p>此时如果web服务器上部署了一个项目，假定一个get请求<code>/hello</code>返回一段字符串，此时在访问<code>192.168.186.128:82/hello</code>就相当于<code>192.168.186.129:8080/hello</code>，从而返回指定的字符串。</p>
</blockquote>
</li>
</ul>
<h3 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h3><blockquote>
<p>其实也是反向代理的一种应用</p>
</blockquote>
<h4 id="概念-1"><a href="#概念-1" class="headerlink" title="概念"></a>概念</h4><p>早期的网站流量和业务功能都比较简单，单台服务器就可以满足基本需求，但是随着互联网的发展，业务流量越来越大并且业务逻辑也越来越复杂，单台服务器的性能及单点故障问题就凸显出来了，因此需要<strong>多台服务器组成应用集群</strong>，进行性能的水平扩展以及避免单点故障出现。</p>
<ul>
<li><p>应用集群：将同一应用部署到多台机器上，组成应用集群，接收负载均衡器分发的请求，进行业务处理并返回响应数据。</p>
</li>
<li><p>负载均衡器：将用户请求根据对应的负载均衡算法分发到应用集群中的一台服务器进行处理。</p>
</li>
</ul>
<p><img src="/2023/07/02/ReggieOptim/image-20230710141655669.png" alt="image-20230710141655669"></p>
<h4 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h4><blockquote>
<p>首先假定有一个代理服务器，两个web服务器。</p>
<p>web服务器的ip为<code>192.168.186.127</code>。两个web服务器的ip为<code>192.168.186.128</code>和<code>192.168.186.129</code>，然后两台机器都跑一个测试项目，但是修改输出区别不同的服务器。（可以让方法输出ip地址）</p>
</blockquote>
<ul>
<li><p>修改服务器的配置文件：<code>nginx.conf</code>。并且重新加载配置文件：<code>nginx -s reload</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">upstream targetServer&#123;     #upstream指令可以定义一组服务器</span><br><span class="line">    server 192.168.186.128;</span><br><span class="line">    server 192.168.186.129;</span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen       82;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://targetServer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p>然后访问代理服务器的<code>192.168.186.127:82</code>端口，就会转发到上面两个web服务器中的一个，且默认是轮询方法，也就是1-2-1-2交替</p>
</li>
</ul>
<p><strong>负载均衡策略</strong></p>
<blockquote>
<p>默认是轮询算法，第一次访问是<code>192.168.186.128</code>，第二次访问是<code>192.168.186.129</code><br>也可以改用权重方式，权重越大，几率越大，现在的访问三分之二是第一台服务器接收，三分之一是第二台服务器接收<br><code>server 192.168.186.128 weight=10</code>; <code>server 192.168.186.129 weight=5</code></p>
</blockquote>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">轮询</td>
<td align="left">默认方式</td>
</tr>
<tr>
<td align="left">weight</td>
<td align="left">权重方式</td>
</tr>
<tr>
<td align="left">ip_hash</td>
<td align="left">依据ip分配方式</td>
</tr>
<tr>
<td align="left">least_conn</td>
<td align="left">依据最少连接方式</td>
</tr>
<tr>
<td align="left">url_hash</td>
<td align="left">依据url分配方式</td>
</tr>
<tr>
<td align="left">fair</td>
<td align="left">依据响应时间方式</td>
</tr>
</tbody></table>
<hr>
<h1 id="前后端分离开发"><a href="#前后端分离开发" class="headerlink" title="前后端分离开发"></a>前后端分离开发</h1><p>之前开发存在的问题：</p>
<ul>
<li>开发人员同时负责前端和后端代码开发，分工不明确，开发效率低</li>
<li>前后端代码混合在一个工程中，不便于管理</li>
<li>对开发人员要求高，人员招聘困难</li>
</ul>
<p>所以衍生出了一种前后端分离开发。</p>
<h2 id="前后端分离开发-1"><a href="#前后端分离开发-1" class="headerlink" title="前后端分离开发"></a>前后端分离开发</h2><h3 id="介绍-3"><a href="#介绍-3" class="headerlink" title="介绍"></a>介绍</h3><p><strong>前后端分离开发</strong>，就是在项目开发过程中，对前端代码的开发专门由前端开发人员负责，后端代码由后端开发人员负责，这样可以做到分工明确，各司其职，提高开发效率，前后端代码并行开发，可以加快项目的开发速度。目前，前后端分离开发方式已经被越来越多的公司采用了，成为现在项目开发的主流开发方式。</p>
<p>前后端分离开发后，从工程结构上也会发生变化，即前后端代码不再混合在同一个maven工程中，而是分为<strong>前端工程和后端工程</strong></p>
<p><img src="/2023/07/02/ReggieOptim/image-20230710143916867.png" alt="image-20230710143916867"></p>
<h3 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h3><p>前后端开发人员都参照接口API文档进行开发。<strong>接口（API接口）</strong> 就是一个http的请求地址，主要就是去定义：请求路径、请求方式、请求参数、响应参数等内容。</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230710144148801.png" alt="image-20230710144148801"></p>
<h2 id="YApi"><a href="#YApi" class="headerlink" title="YApi"></a>YApi</h2><blockquote>
<p>更多可能是项目经理做的工作</p>
</blockquote>
<h3 id="介绍-4"><a href="#介绍-4" class="headerlink" title="介绍"></a>介绍</h3><p>YApi是高效、易用、功能强大的api管理平台，旨在为开发、产品、测试人员提供更优雅的接口管理服务。可以帮助开发者轻松创建、发布、维护API，YApi还为用户提供了优秀的交互体验，开发人员只需要利用平台提供的接口数据写入工具以及简单的点击操作就可以实现接口的管理。</p>
<p>YApi让接口开发更简单高效，让接口的管理更具有可读性、可维护性，让团队协作更合理。Git仓库：<a target="_blank" rel="noopener" href="https://github.com/YMFE/yapi%E3%80%82%E8%A6%81%E4%BD%BF%E7%94%A8YApi%EF%BC%8C%E9%9C%80%E8%A6%81%E8%87%AA%E5%B7%B1%E8%BF%9B%E8%A1%8C%E9%83%A8%E7%BD%B2%E3%80%82">https://github.com/YMFE/yapi。要使用YApi，需要自己进行部署。</a></p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ul>
<li>使用YApi，可以执行下面操作：<ul>
<li>添加项目</li>
<li>添加分类</li>
<li>添加接口</li>
<li>编辑接口</li>
<li>查看接口</li>
</ul>
</li>
</ul>
<h2 id="Swagger"><a href="#Swagger" class="headerlink" title="Swagger"></a>Swagger</h2><blockquote>
<p>后端常用</p>
</blockquote>
<h3 id="介绍-5"><a href="#介绍-5" class="headerlink" title="介绍"></a>介绍</h3><p>使用Swagger你只需要按照它的规范去定义接口及接口相关的信息，再通过Swagger衍生出来的一系列项目和工具，就可以做成各种格式的接口文档，以及在线接口调试页面等。官网：<a target="_blank" rel="noopener" href="https://swagger.io/">https://swagger.io/</a></p>
<p>这里用的是<code>knife4j</code>，是Java MVC框架集成Swagger生成Api文档的增强解决方案</p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><ol>
<li><p>导入Maven坐标依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>knife4j-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入knife4j相关配置类</p>
<p>在<code>config</code>包下的<code>WebMvcConfig</code>中进行配置。主要添加两个注解<code>@EnableSwagger2</code>和<code>@EnableKnife4j</code>和注入一个bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="meta">@EnableKnife4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">        <span class="comment">//创建消息转换器对象</span></span><br><span class="line">        <span class="type">MappingJackson2HttpMessageConverter</span> <span class="variable">messageConverter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">        <span class="comment">//设置对象转化器，底层使用jackson将java对象转为json</span></span><br><span class="line">        messageConverter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">        <span class="comment">//将上面的消息转换器对象追加到mvc框架的转换器集合当中(index设置为0，表示设置在第一个位置，避免被其它转换器接收，从而达不到想要的功能)</span></span><br><span class="line">        converters.add(<span class="number">0</span>, messageConverter);</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Docket <span class="title function_">createRestApi</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//文档类型</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.wzy.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.any())</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//新增</span></span><br><span class="line">    <span class="keyword">private</span> ApiInfo <span class="title function_">apiInfo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">                .title(<span class="string">&quot;瑞吉外卖&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;瑞吉外卖接口文档&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：将controller路径改为自己的包路径</p>
</blockquote>
</li>
<li><p>设置静态资源，否则接口文档页面无法访问。不过如果是<strong>SpringBoot项目</strong>，静态资源文件夹默认在那个位置，所以不用设置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">registry.addResourceHandler(<span class="string">&quot;doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在LoginCheckFilter中设置不需要处理的请求路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义不需要处理的请求</span></span><br><span class="line">String[] urls = <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;</span><br><span class="line">    <span class="string">&quot;/employee/login&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/employee/logout&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/backend/**&quot;</span>, <span class="comment">//静态资源</span></span><br><span class="line">    <span class="string">&quot;/front/**&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/common/**&quot;</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//对用户登陆操作放行</span></span><br><span class="line">    <span class="string">&quot;/user/login&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/user/sendMsg&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Swagger放行</span></span><br><span class="line">    <span class="string">&quot;/doc.html&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/webjars/**&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/swagger-resources&quot;</span>,</span><br><span class="line">    <span class="string">&quot;/v2/api-docs&quot;</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</li>
<li><p>到这里直接启动，我这里会启动失败，根据网络查询，是因为swagger版本和springboot2.6以上版本出现了<strong>不兼容情况</strong>，需要在<code>application.yml</code>中做如下配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">pathmatch:</span></span><br><span class="line">      <span class="attr">matching-strategy:</span> <span class="string">ant_path_matcher</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动服务，访问 <a target="_blank" rel="noopener" href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a> 即可看到生成的接口文档</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230710161123044.png" alt="image-20230710161123044"></p>
</li>
</ol>
<h3 id="常用注释"><a href="#常用注释" class="headerlink" title="常用注释"></a>常用注释</h3><table>
<thead>
<tr>
<th align="left">注解</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Api</td>
<td align="left">用在请求的类上，例如Controller，表示对类的说明</td>
</tr>
<tr>
<td align="left">@ApiModel</td>
<td align="left">用在类上，通常是个实体类，表示一个返回响应数据的信息</td>
</tr>
<tr>
<td align="left">@ApiModelProperty</td>
<td align="left">用在属性上，描述响应类的属性</td>
</tr>
<tr>
<td align="left">@ApiOperation</td>
<td align="left">用在请求的方法上，说明方法的用途、作用</td>
</tr>
<tr>
<td align="left">@ApilmplicitParams</td>
<td align="left">用在请求的方法上，表示一组参数说明</td>
</tr>
<tr>
<td align="left">@ApilmplicitParam</td>
<td align="left">用在@ApilmplicitParams注解中，指定一个请求参数的各个方面</td>
</tr>
</tbody></table>
<p>加上这些注解，可以让生成的接口文档更规范。示例如下：</p>
<p><code>user.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(&quot;用户&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;主键&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//姓名</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;姓名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//手机号</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;手机号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//性别 0 女 1 男</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;性别 0 女 1 男&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//身份证号</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;身份证号&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//头像</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;头像&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//状态 0:禁用，1:正常</span></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;状态 0:禁用，1:正常&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>UserController.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;用户相关接口&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> user</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> MessagingException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendMsg&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;发送验证接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">sendMsg</span><span class="params">(<span class="meta">@RequestBody</span> User user, HttpSession session)</span> <span class="keyword">throws</span> MessagingException &#123;</span><br><span class="line">        <span class="comment">//获取手机号/邮箱</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> user.getPhone();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用工具类完成验证码发送</span></span><br><span class="line">        <span class="keyword">if</span> (!phone.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">//随机生成一个验证码</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> MailUtils.achieveCode();</span><br><span class="line">            log.info(<span class="string">&quot;生成的验证码：&#123;&#125;&quot;</span>, code);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//这里的phone其实就是邮箱，code是我们生成的验证码</span></span><br><span class="line">            MailUtils.sendTestMail(phone, code); <span class="comment">//这部分抛出异常</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//[old]将要发送的验证码保存在session，然后与用户填入的验证码进行对比</span></span><br><span class="line"><span class="comment">//            session.setAttribute(phone, code);</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//[new]将生成的验证码缓存到Redis中，并设置有效期为5分钟</span></span><br><span class="line">            redisTemplate.opsForValue().set(phone, code, <span class="number">5</span>, TimeUnit.MINUTES);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> R.success(<span class="string">&quot;验证码发送成功&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;验证码发送失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移动端用户登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;用户登录接口&quot;)</span></span><br><span class="line">    <span class="meta">@ApiImplicitParam(name = &quot;map&quot;,value = &quot;map集合接收数据&quot;,required = true)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;User&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> Map map, HttpSession session)</span> &#123;</span><br><span class="line">        log.info(map.toString());</span><br><span class="line">        <span class="comment">//获取邮箱</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> map.get(<span class="string">&quot;phone&quot;</span>).toString();</span><br><span class="line">        <span class="comment">//获取验证码</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> map.get(<span class="string">&quot;code&quot;</span>).toString();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//[old]从session中获取保存的验证码</span></span><br><span class="line"><span class="comment">//        Object codeInSession = session.getAttribute(phone);</span></span><br><span class="line"><span class="comment">//        log.info(&quot;session中的缓存验证码：&#123;&#125;&quot;, codeInSession);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//[new]从Redis中获取缓存验证码</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">codeInSession</span> <span class="operator">=</span> redisTemplate.opsForValue().get(phone);</span><br><span class="line">        log.info(<span class="string">&quot;redis中的缓存验证码：&#123;&#125;&quot;</span>, codeInSession);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//进行验证码的比对</span></span><br><span class="line">        <span class="keyword">if</span> (codeInSession != <span class="literal">null</span> &amp;&amp; codeInSession.equals(code)) &#123;</span><br><span class="line">            <span class="comment">//判断一下当前用户是否存在</span></span><br><span class="line">            LambdaQueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">            <span class="comment">//从数据库中查询是否有其邮箱</span></span><br><span class="line">            queryWrapper.eq(User::getPhone, phone);</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getOne(queryWrapper);</span><br><span class="line">            <span class="comment">//如果不存在，则创建一个，存入数据库</span></span><br><span class="line">            <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">                user = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">                user.setPhone(phone);</span><br><span class="line">                user.setStatus(<span class="number">1</span>);</span><br><span class="line">                userService.save(user);</span><br><span class="line">                user.setName(<span class="string">&quot;游客&quot;</span> + codeInSession);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//登录成功后，需要保存session，表示登录状态，因为前面的过滤器进行了用户登录判断</span></span><br><span class="line">            session.setAttribute(<span class="string">&quot;user&quot;</span>, user.getId());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//[new]如果用户登录成功，删除redis中缓存的验证码</span></span><br><span class="line">            redisTemplate.delete(phone);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//并将其作为结果返回</span></span><br><span class="line">            <span class="keyword">return</span> R.success(user);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> R.error(<span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户登出</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loginout&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;用户登出接口&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> R&lt;String&gt; <span class="title function_">loginout</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        request.getSession().removeAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> R.success(<span class="string">&quot;退出成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时生成新的文档，可以看出user相关内容已经变成中文说明，并且相应参数也有对应的说明</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230710162509580.png" alt="image-20230710162509580"></p>
<h2 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h2><h3 id="部署环境说明"><a href="#部署环境说明" class="headerlink" title="部署环境说明"></a>部署环境说明</h3><p><img src="/2023/07/02/ReggieOptim/image-20230710163027723.png" alt="image-20230710162928826"></p>
<p>一共需要三台服务器</p>
<ul>
<li>192.168.186.128（服务器A）<ul>
<li>Nginx：部署前端项目、配置反向代理</li>
<li>MySql：主从复制结构中的主库</li>
</ul>
</li>
<li>192.168.186.129（服务器B）<ul>
<li>jdk：运行java项目</li>
<li>git：版本控制工具</li>
<li>maven：项目构建工具</li>
<li>jar：Spring Boot 项目打成jar包基于内置Tomcat运行</li>
<li>MySql：主从复制结构中的从库</li>
</ul>
</li>
<li>192.168.186.128（服务器C，这里我用服务器A进行缓存）<ul>
<li>Redis：缓存中间件</li>
</ul>
</li>
</ul>
<h3 id="部署前端项目"><a href="#部署前端项目" class="headerlink" title="部署前端项目"></a>部署前端项目</h3><ol>
<li><p>在服务器A中安装Nginx，将<strong>前端项目打包</strong>目录上传到Nginx的html目录下</p>
<blockquote>
<p>这里是直接拿来课程资源中的打包好的<code>dist</code>，如果实际使用需要自己打包，因为部分前端内容做了调整</p>
</blockquote>
</li>
<li><p>修改Nginx配置文件nginx.conf，新增如下配置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">listen</span> <span class="string">80;</span></span><br><span class="line">    <span class="attr">server_name</span> <span class="string">localhost;</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">location</span> <span class="string">/ &#123;</span></span><br><span class="line">        <span class="attr">root</span> <span class="string">html/dist;</span></span><br><span class="line">        <span class="attr">index</span> <span class="string">index.html;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="comment">    #反向代理配置</span></span><br><span class="line">    <span class="attr">location</span> <span class="string">^~ /api/ &#123;</span></span><br><span class="line">        <span class="attr">rewrite</span> <span class="string">^/api/(.*)$ /$1 break;</span></span><br><span class="line">        <span class="attr">proxy_pass</span> <span class="string">http://192.168.186.129:8080;</span></span><br><span class="line">    <span class="attr">&#125;</span></span><br><span class="line"><span class="attr">&#125;</span></span><br></pre></td></tr></table></figure>

<p>记得修改后reload配置文件：<code>nginx -s reload</code></p>
</li>
<li><p>启动Nginx服务器测试，显示前端页面：</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230710170053781.png" alt="image-20230710170053781"></p>
</li>
</ol>
<p>补充：针对前面2中的反向代理设置中的<code>rewrite</code>部分内容的作用：</p>
<ul>
<li>当我们点击了前端登录页面后，会发送如下请求：</li>
</ul>
<p><img src="/2023/07/02/ReggieOptim/image-20230710170236768.png" alt="image-20230710170236768"></p>
<ul>
<li>而实际后端controller中，只是对<code>192.168.186.129:8080/employee/login</code>请求做处理，二者相差了<code>/api</code>内容，所以通过<code>rewrite</code>去除内容</li>
</ul>
<h3 id="部署后端项目"><a href="#部署后端项目" class="headerlink" title="部署后端项目"></a>部署后端项目</h3><p>在服务器B中安装JDK，Git，MySql。</p>
<ul>
<li>服务器C开启Redis服务：进入redis的根目录下执行<code>src/redis-server ./redis.conf</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">42106:C 10 Jul 17:21:47.854 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">42106:C 10 Jul 17:21:47.854 <span class="comment"># Redis version=4.0.0, bits=64, commit=00000000, modified=0, pid=42106, just started</span></span><br><span class="line">42106:C 10 Jul 17:21:47.854 <span class="comment"># Configuration loaded</span></span><br></pre></td></tr></table></figure>

<ul>
<li>修改配置文件中的图片路径以及redis相关内容：</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="comment"># redis缓存</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.186</span><span class="number">.128</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">cache:</span></span><br><span class="line">    <span class="attr">redis:</span></span><br><span class="line">      <span class="attr">time-to-live:</span> <span class="number">3600000</span> <span class="comment">#设置存活时间为一小时，如果不设置，则一直存活</span></span><br><span class="line"></span><br><span class="line"><span class="attr">reggie:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">/usr/local/img/</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>将项目打成jar包，手动上传并部署。打包使用maven的package即可，然后将jar包上传服务器B，在包所在目录下执行命令：<code>java -jar [打包好的jar包名]</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost reggie]# java -jar springboot_reggie-0.0.1-SNAPSHOT.jar </span><br><span class="line"></span><br><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> /\\ / ___&#x27;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#x27;_ | &#x27;_| | &#x27;_ \/ _` | \ \ \ \</span><br><span class="line"> \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#x27;  |____| .__|_| |_|_| |_\__, | / / / /</span><br><span class="line"> =========|_|==============|___/=/_/_/_/</span><br><span class="line"> :: Spring Boot ::               (v2.7.12)</span><br><span class="line"></span><br><span class="line">2023-07-10 17:31:25.717  INFO 67520 --- [           main] com.wzy.SpringbootReggieApplication      : Starting SpringbootReggieApplication v0.0.1-SNAPSHOT using Java 1.8.0_171 on localhost.localdomain with PID 67520 (/usr/local/reggie/springboot_reggie-0.0.1-SNAPSHOT.jar started by root in /usr/local/reggie)</span><br><span class="line">2023-07-10 17:31:25.732  INFO 67520 --- [           main] com.wzy.SpringbootReggieApplication      : No active profile set, falling back to 1 default profile: &quot;default&quot;</span><br><span class="line">2023-07-10 17:31:29.678  INFO 67520 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode</span><br><span class="line">2023-07-10 17:31:29.681  INFO 67520 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.</span><br><span class="line">2023-07-10 17:31:29.712  INFO 67520 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 12 ms. Found 0 Redis repository interfaces.</span><br><span class="line">2023-07-10 17:31:31.122  INFO 67520 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span><br><span class="line">2023-07-10 17:31:31.143  INFO 67520 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2023-07-10 17:31:31.143  INFO 67520 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.75]</span><br><span class="line">2023-07-10 17:31:31.931  INFO 67520 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2023-07-10 17:31:31.932  INFO 67520 --- [           main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 4434 ms</span><br><span class="line">Logging initialized using &#x27;class org.apache.ibatis.logging.stdout.StdOutImpl&#x27; adapter.</span><br><span class="line">2023-07-10 17:31:33.435  INFO 67520 --- [           main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited</span><br><span class="line">2023-07-10 17:31:33.927  INFO 67520 --- [           main] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-2&#125; inited</span><br><span class="line">Registered plugin: &#x27;com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor@67c33749&#x27;</span><br><span class="line">Property &#x27;mapperLocations&#x27; was not specified.</span><br><span class="line"> _ _   |_  _ _|_. ___ _ |    _ </span><br><span class="line">| | |\/|_)(_| | |_\  |_)||_|_\ </span><br><span class="line">     /               |         </span><br><span class="line">                        3.4.2 </span><br><span class="line">2023-07-10 17:31:37.631  INFO 67520 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#x27;&#x27;</span><br><span class="line">2023-07-10 17:31:37.644  INFO 67520 --- [           main] com.wzy.SpringbootReggieApplication      : Started SpringbootReggieApplication in 14.327 seconds (JVM running for 16.383)</span><br><span class="line">2023-07-10 17:31:37.646  INFO 67520 --- [           main] com.wzy.SpringbootReggieApplication      : 项目启动成功</span><br></pre></td></tr></table></figure>

<blockquote>
<p>也可以选择git拉取代码，然后shell脚本自动部署，此时还需要安装Maven，具体内容参考Linux入门中项目部署章节）</p>
</blockquote>
</li>
</ul>
<p>部署完后端项目之后，就能完成正常的登录功能了，也能进入到后台系统进行增删改查操作</p>
<p><img src="/2023/07/02/ReggieOptim/image-20230710173301342.png" alt="image-20230710173301342"></p>
<p>并且修改内容，在对应的主服务器和从服务器上的mysql数据同时变化，实现了MySQL主从分离。</p>
<p>至于缓存功能，代码中只对手机端套餐显示上添加了redis缓存，但是课程资源中并没有给出手机端的页面，所以目前没有测试Redis缓存功能。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">wzy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/07/02/ReggieOptim/">http://example.com/2023/07/02/ReggieOptim/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Wzy's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/springboot/">springboot</a><a class="post-meta__tags" href="/tags/Nginx/">Nginx</a><a class="post-meta__tags" href="/tags/Cache/">Cache</a></div><div class="post_share"><div class="social-share" data-image="/img/cheems.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/02/Git%E5%AD%A6%E4%B9%A0/" title="Git版本控制工具"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git版本控制工具</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/02/Reggie/" title="瑞吉外卖"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">瑞吉外卖</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/07/02/Reggie/" title="瑞吉外卖"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-02</div><div class="title">瑞吉外卖</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cheems.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">wzy</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">11</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Git%E7%AE%A1%E7%90%86%E4%BB%A3%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">Git管理代码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E4%BC%98%E5%8C%96"><span class="toc-number">2.</span> <span class="toc-text">缓存优化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">环境搭建</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%9D%90%E6%A0%87"><span class="toc-number">2.1.1.</span> <span class="toc-text">导入坐标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.1.2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">2.1.3.</span> <span class="toc-text">配置类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">2.2.</span> <span class="toc-text">缓存短信验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF"><span class="toc-number">2.2.1.</span> <span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%94%B9%E9%80%A0"><span class="toc-number">2.2.2.</span> <span class="toc-text">代码改造</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E8%8F%9C%E5%93%81%E6%95%B0%E6%8D%AE"><span class="toc-number">2.3.</span> <span class="toc-text">缓存菜品数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-1"><span class="toc-number">2.3.1.</span> <span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%94%B9%E9%80%A0-1"><span class="toc-number">2.3.2.</span> <span class="toc-text">代码改造</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">2.3.3.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring-Cache"><span class="toc-number">2.4.</span> <span class="toc-text">Spring Cache</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">2.4.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.4.2.</span> <span class="toc-text">常用注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">2.4.3.</span> <span class="toc-text">使用方式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%A5%97%E9%A4%90%E6%95%B0%E6%8D%AE"><span class="toc-number">2.5.</span> <span class="toc-text">缓存套餐数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E6%80%9D%E8%B7%AF-2"><span class="toc-number">2.5.1.</span> <span class="toc-text">实现思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E4%BF%AE%E6%94%B9"><span class="toc-number">2.5.2.</span> <span class="toc-text">代码修改</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">3.</span> <span class="toc-text">读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-number">3.1.</span> <span class="toc-text">问题分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">3.2.</span> <span class="toc-text">MySQL主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.2.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%8B%E9%9A%86"><span class="toc-number">3.2.2.1.</span> <span class="toc-text">虚拟机克隆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%B8%BB%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">3.2.2.2.</span> <span class="toc-text">配置主从服务器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%91%9E%E5%90%89%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.</span> <span class="toc-text">瑞吉项目实现</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.1.</span> <span class="toc-text">导入数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%81%E7%A8%8B%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.3.2.</span> <span class="toc-text">流程实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Nginx"><span class="toc-number">4.</span> <span class="toc-text">Nginx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">4.1.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-2"><span class="toc-number">4.1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%92%8C%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.2.</span> <span class="toc-text">下载和安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">4.1.3.</span> <span class="toc-text">目录结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">4.2.</span> <span class="toc-text">命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">4.3.</span> <span class="toc-text">配置文件结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B7%E4%BD%93%E5%BA%94%E7%94%A8"><span class="toc-number">4.4.</span> <span class="toc-text">具体应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">4.4.1.</span> <span class="toc-text">部署静态资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86"><span class="toc-number">4.4.2.</span> <span class="toc-text">反向代理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">4.4.2.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-1"><span class="toc-number">4.4.2.2.</span> <span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">4.4.3.</span> <span class="toc-text">负载均衡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5-1"><span class="toc-number">4.4.3.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE-2"><span class="toc-number">4.4.3.2.</span> <span class="toc-text">配置</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91"><span class="toc-number">5.</span> <span class="toc-text">前后端分离开发</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E5%BC%80%E5%8F%91-1"><span class="toc-number">5.1.</span> <span class="toc-text">前后端分离开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-3"><span class="toc-number">5.1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B"><span class="toc-number">5.1.2.</span> <span class="toc-text">开发流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#YApi"><span class="toc-number">5.2.</span> <span class="toc-text">YApi</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-4"><span class="toc-number">5.2.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">5.2.2.</span> <span class="toc-text">使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Swagger"><span class="toc-number">5.3.</span> <span class="toc-text">Swagger</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-5"><span class="toc-number">5.3.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-1"><span class="toc-number">5.3.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E9%87%8A"><span class="toc-number">5.3.3.</span> <span class="toc-text">常用注释</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-number">5.4.</span> <span class="toc-text">项目部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="toc-number">5.4.1.</span> <span class="toc-text">部署环境说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.4.2.</span> <span class="toc-text">部署前端项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E9%A1%B9%E7%9B%AE"><span class="toc-number">5.4.3.</span> <span class="toc-text">部署后端项目</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/06/MeassageQueue/" title="MeassageQueue">MeassageQueue</a><time datetime="2023-08-06T07:41:56.000Z" title="发表于 2023-08-06 15:41:56">2023-08-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/08/04/Docker/" title="Docker">Docker</a><time datetime="2023-08-04T06:11:43.000Z" title="发表于 2023-08-04 14:11:43">2023-08-04</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/27/SpringCloud/" title="SpringCloud">SpringCloud</a><time datetime="2023-07-27T04:07:19.000Z" title="发表于 2023-07-27 12:07:19">2023-07-27</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/25/Java8%E6%96%B0%E7%89%B9%E6%80%A7/" title="Java8新特性">Java8新特性</a><time datetime="2023-07-25T06:42:16.000Z" title="发表于 2023-07-25 14:42:16">2023-07-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2023/07/13/Redis%E5%AE%9E%E6%88%98/" title="Redis实战">Redis实战</a><time datetime="2023-07-13T02:47:40.000Z" title="发表于 2023-07-13 10:47:40">2023-07-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By wzy</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>